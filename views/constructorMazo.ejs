<%- include('./components/headerLogged') %>

  <body>
    <% if (mensajeError) { %>
      <div id="mensaje-error" class="mensaje mensaje_error">
        <span class="cerrar" onclick="cerrarMensajeError()"> &nbsp; x</span>
        <%= mensajeError %>
      </div>
      <% } %>
        <% if (mensajeExito) { %>
          <div id="mensaje-exito" class="mensaje mensaje_exito">
            <span class="cerrar" onclick="cerrarMensajeExito()"> &nbsp; x</span>
            <%= mensajeExito %>
          </div>
          <% } %>
            <div class="container">
              <h1> Mazo <%= mazoId %>
              </h1>
              <h1>Lista de Cartas</h1>
              <div class="card-list">
                <% if (cartasMazo.length> 0) { %>
                  <% cartasMazo.forEach(function(carta) { %>
                    <button class='cantidad-cartas'>
                      <%= cantidades[carta.codigo] %>
                    </button>
                    <!-- <div class="card"> -->
                    <!-- <h2><%= carta.nombre %></h2> -->
                    <!-- <p>Código: <%= carta.codigo %></p>
                <p>Tipo: <%= carta.tipo %></p>
                <p>Coste: <%= carta.coste %></p>
                <p>Habilidad: <%= carta.habilidad %></p>
                <p>Fuerza: <%= carta.fuerza %></p>
                <p>Raza: <%= carta.raza %></p> -->
                    <% if (carta.imagen) { %>
                      <img src="data:image/png;base64,<%= carta.imagen.toString('base64') %>" class="carta-imagen">
                      <% } %>
                        <form action="/eliminarCarta" method="POST">
                          <input type="hidden" name="mazoId" value="<%= mazoId %>">
                          <input type="hidden" name="codigo_carta" value="<%= carta.codigo %>">
                          <button type="submit">X</button>
                        </form>
                        <!-- </div> -->
                        <% }); %>
                          <% } else { %>
                            <p>Ninguna carta agregada al mazo</p>
                            <% } %>
              </div>
              <h1> </h1>
              <!-- <form action="/agregarCarta" method="POST">
          <input type="hidden" name="mazoId" value="<%= mazoId %>">
          <select id="carta_agregar" name="codigo_carta">
            <% cartas.forEach(function(carta) { %>
              <option value="<%= carta.codigo %>"><%= carta.nombre%></option>
            <% }); %>
          </select>
          <button type="submit">Agregar Carta</button>
        </form>  -->

              <section class="buscadorm" style="height: fit-content;">
                <form action="/visualizadorParaMazo" method="GET">
                  <h1>Cartas </h1>
                  <div class="form-group">
                    <input class="nombre_mazo" name="search" placeholder="Buscar por nombre...">
                  </div>
                  <div class="form-group">
                    <label for="tipo">Tipo:</label>
                    <select id="tipo_mazo" name="tipo">
                      <option value="">Todos</option>
                      <option value="oro">Oro</option>
                      <option value="Aliado">Aliado</option>
                      <option value="Talismán">Talisman</option>
                      <option value="Totem">Totem</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="raza">Raza:</label>
                    <select id="tipo_mazo" name="raza">
                      <option value="">Todas</option>
                      <option value="Eterno">Eterno</option>
                      <option value="Bestia">Bestia</option>
                      <option value="Caballero">Caballero</option>
                      <option value="Sacerdote">Sacerdote</option>
                      <option value="Sombra">Sombra</option>
                      <option value="Faerie">Faerie</option>
                      <option value="Guerrero">Guerrero</option>
                      <option value="Heroe">Heroe</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="coste">Coste:</label>
                    <input type="number" id="coste" name="coste" min="0" max="5">
                  </div>
                  <div class="form-group">
                    <label for="fuerza">Fuerza:</label>
                    <input type="number" id="fuerza" name="fuerza" min="0" max="10">
                  </div>
                  <div class="form-group">
                    <input type="hidden" name="mazoId" value="<%= mazoId %>">
                    <button type="submit">Buscar</button>
                  </div>
                </form>
                <form action="/agregarcarta" method="POST">
                  <ol id="lista3">
                    <% cartas.forEach(function(carta) { %>
                      <li>
                        <% if (carta.imagen) { %>
                            <img src="data:image/png;base64,<%= carta.imagen.toString('base64') %>" class="carta-imagen" onclick="agregarCarta('<%= mazoId %>', '<%= carta.codigo %>')">
                        <% } %>
                      </li>
                    <% }); %>
                  </ol>
                </form>
              </section>
              <script>
                function agregarCarta(mazoId, codigoCarta) {
                  var form = document.createElement('form');
                  form.method = 'POST';
                  form.action = '/agregarcarta';
              
                  var mazoIdInput = document.createElement('input');
                  mazoIdInput.type = 'hidden';
                  mazoIdInput.name = 'mazoId';
                  mazoIdInput.value = mazoId;
              
                  var codigoCartaInput = document.createElement('input');
                  codigoCartaInput.type = 'hidden';
                  codigoCartaInput.name = 'codigo_carta';
                  codigoCartaInput.value = codigoCarta;
              
                  form.appendChild(mazoIdInput);
                  form.appendChild(codigoCartaInput);
              
                  document.body.appendChild(form);
                  form.submit();
                }
              </script>
              <script>
                function cerrarMensajeExito() {
                  var mensajeExito = document.getElementById('mensaje-exito');
                  mensajeExito.style.display = 'none';
                }

                function cerrarMensajeError() {
                  var mensajeError = document.getElementById('mensaje-error');
                  mensajeError.style.display = 'none';
                }
              </script>

  </body>

  </html>